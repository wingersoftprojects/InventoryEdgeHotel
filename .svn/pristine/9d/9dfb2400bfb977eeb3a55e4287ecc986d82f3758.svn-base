<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Payment</title>
        <link rel="stylesheet" type="text/css" href="style.css"/>
        <script  language="javascript">
            function confirmDelete()
            {
                return confirm('Are you sure you want to delete this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
            function confirmCancel()
            {
                return confirm('Are you sure you want to Cancel this current record?');
            }
            function alertSave()
            {
                return alert('Record saved successfully!');
            }
        </script> 
    </h:head>
    <f:event listener="#{navigationBean.checkAccessDenied('PAYMENT', 'View')}" type="preRenderView" />
    <f:event listener="#{navigationBean.checkCurrentPage('PAYMENT','','')}" type="preRenderView" />
    <f:event listener="#{payBean.initClearPay(pay,payBean.selectedBillTransactor)}" type="preRenderView" />
    <h:body>
        <ui:include src="Menu.xhtml"/>
        <h:form id="formPay" styleClass="clsMainFrom" onkeypress="if (event.keyCode == 13)
                    return false;">

            <h:panelGrid styleClass="clsGridMainHeader" columns="1">
                <h:outputLabel styleClass="clsLabelTop" id="olblPaymentHeader" value="PAYMENT - #{generalUserSetting.getCurrentPayCategory()}"/>
            </h:panelGrid>

            <h:panelGrid styleClass="clsGridMainInput" columns="5" style="background-color: chocolate">
                <h:outputLabel styleClass="clsLabel" value="TRANSACTOR:"/>
                <p:autoComplete id="autcTransactor" value="#{payBean.selectedBillTransactor}" 
                                completeMethod="#{transactorBean.getTransactorObjectList}" 
                                var="trct" 
                                itemLabel="#{trct.transactorNames}" 
                                itemValue="#{trct}" 
                                converter="TransactorConverter" style="text-align: left" 
                                forceSelection="true" 
                                >
                    <p:column headerText="Transactor Names" style="text-align: left" >  
                        #{trct.transactorNames} 
                    </p:column> 
                    <p:column headerText="Type" style="text-align: left" >  
                        #{trct.transactorType} 
                    </p:column> 
                    <p:column headerText="Contact Person" style="text-align: left">  
                        #{trct.cpName} 
                    </p:column> 
                    <p:ajax event="itemSelect" listener="#{pay.setBillTransactorId(payBean.selectedBillTransactor.transactorId)}" update="menuTransaction,dtblPay,buttons,menuTransactionType,menuTransactionReason" />
                    <p:ajax event="change" listener="#{pay.setBillTransactorId(payBean.selectedBillTransactor.transactorId)}" rendered="#{payBean.selectedBillTransactor!=null}" update="menuTransaction,dtblPay,buttons,menuTransactionType,menuTransactionReason" />
                </p:autoComplete>

                <h:outputLabel styleClass="clsLabel" value="--(or)--"/>

                <h:outputLabel styleClass="clsLabel" value="TRANS.ID:"/>
                <h:inputText id="itxtTransactionId2" value="#{trans.transactionId2}" autocomplete="off">
                    <f:ajax event="change" render="menuTransaction dtblPay menuTransactionType menuTransactionReason" />
                </h:inputText>

            </h:panelGrid>

            <h:panelGrid>
                <h:panelGrid columns="7">
                    <h:outputLabel styleClass="clsLabel" value="Transaction:"/>
                    <h:selectOneMenu styleClass="clsMenu" id="menuTransaction" value="#{pay.transactionId}">
                        <f:selectItem itemValue="0" itemLabel=""/>
                        <f:selectItems value="#{transBean.getTranssByBillTrPayCat(trans.transactionId2,payBean.selectedBillTransactor.transactorId,generalUserSetting.getCurrentPayCategory())}" var="trn" itemLabel="Trans(#{trn.transactionId}), Amount(#{trn.grandTotal})" itemValue="#{trn.transactionId}"/>
                        <f:ajax event="change" render="menuTransactionType menuTransactionReason"/>
                    </h:selectOneMenu>
                    <h:outputLabel styleClass="clsLabel" value="- OR -"/>
                    <h:outputLabel styleClass="clsLabel" value="TransType:"/>
                    <h:selectOneMenu styleClass="clsMenu" id="menuTransactionType" value="#{pay.transactionTypeId}">
                        <f:selectItem itemValue="0" itemLabel=""/>
                        <f:selectItem itemValue="2" itemLabel="SALE" itemDisabled="#{generalUserSetting.getCurrentPayCategory().equals('OUT')}"/>
                        <f:selectItem itemValue="1" itemLabel="PURCHASE" itemDisabled="#{generalUserSetting.getCurrentPayCategory().equals('IN')}"/>
                        <f:ajax event="change" render="menuTransactionType menuTransactionReason"/>
                    </h:selectOneMenu>
                    <h:outputLabel styleClass="clsLabel" value="TransReason:"/>
                    <h:selectOneMenu styleClass="clsMenu" id="menuTransactionReason" value="#{pay.transactionReasonId}">
                        <f:selectItem itemLabel="" itemValue="0"/>
                        <f:selectItems value="#{transactionReasonBean.getTransactionReasons(pay.transactionTypeId)}" var="tr" itemLabel="#{tr.transactionReasonName}" itemValue="#{tr.transactionReasonId}"/>
                    </h:selectOneMenu>
                </h:panelGrid>

                <h:panelGrid styleClass="clsGridMainInput" columns="2">
                    <h:outputLabel styleClass="clsLabel" value="Payment Date:"/>
                    <p:calendar styleClass="clsInput" id="calPaymentDate" pattern="dd-MM-yyyy" navigator="true" showButtonPanel="true" readonlyInput="true" value="#{pay.payDate}">
                    </p:calendar>

                    <h:outputLabel styleClass="clsLabel" value="Payment Method:"/>
                    <h:selectOneMenu styleClass="clsMenu" id="menuPayMethod" value="#{pay.payMethodId}">
                        <f:selectItems value="#{payMethodBean.payMethods}" var="pm" itemLabel="#{pm.payMethodName}" itemValue="#{pm.payMethodId}"/>
                    </h:selectOneMenu>
                    <h:outputLabel styleClass="clsLabel" value="Payment Ref No:"/>
                    <h:inputText id="itxtPayRefNo" value="#{pay.payRefNo}" styleClass="clsInputTransItem" style="width: 150px;"/>
                    <h:outputLabel styleClass="clsLabel" value="Paid Amount:"/>
                    <h:inputText id="itxtPaidAmount" value="#{pay.paidAmount}" styleClass="clsInputTransItem" style="width: 150px;" autocomplete="off">
                    </h:inputText>
                    <h:outputLabel styleClass="clsLabel" value="Points Amount Spent:"/>
                    <h:inputText id="itxtSpendPointsAmount" value="#{pay.pointsSpentAmount}" styleClass="clsInputTransItem" style="width: 150px;" disabled="true">
                        <f:convertNumber pattern="###,###.##"/>
                    </h:inputText>
                </h:panelGrid>
            </h:panelGrid>
            <h:panelGrid id="buttons" styleClass="clsGridMainCommands" columns="1">
                <h:panelGrid styleClass="clsGridMainCommands1" columns="4">
                    <h:commandButton styleClass="clsButtonBig" value="SAVE (ALT+S)" accesskey="s" rendered="#{payBean.selectedBillTransactor!=null}">
                        <f:ajax listener="#{payBean.savePay(pay)}" execute="@form" render="@form"/>
                    </h:commandButton>
                    <h:commandButton styleClass="clsButtonBig" value="CLEAR (ALT+C)" accesskey="c">
                        <f:ajax listener="#{payBean.clearPay(pay)}" execute="@form" render="@form"/>
                    </h:commandButton>
                </h:panelGrid>
            </h:panelGrid>

            <h:panelGrid styleClass="clsGridMainMessages" columns="1">
                <h:outputLabel styleClass="clsActionMessage" id="olblActionMessage" value="#{payBean.actionMessage}"/>
                <h:messages id="msgsMainMessage" style="color: red"/><br/>
            </h:panelGrid>

            <p:dataTable id="dtblPay" value="#{payBean.getPaysByBillTrPaCa(trans.transactionId2,payBean.selectedBillTransactor.transactorId,generalUserSetting.getCurrentPayCategory())}" var="p" 
                         tableStyle="width:auto;"> 
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Bill Transactor</f:facet>
                    <!-- row record -->
                    #{transactorBean.getTransactor(p.billTransactorId).transactorNames}
                </p:column>
                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Transactor</f:facet>
                    <!-- row record -->
                    #{transactorBean.getTransactor(transBean.getTrans(p.transactionId).transactorId).transactorNames}
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Trans.ID</f:facet>
                    <!-- row record -->
                    #{p.transactionId}
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Trans Amount</f:facet>
                    <!-- row record -->
                    <h:outputLabel value="#{transBean.getTrans(p.transactionId).grandTotal}">
                        <f:convertNumber pattern="###,###,###"/>
                    </h:outputLabel>
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Pay.ID</f:facet>
                    <!-- row record -->
                    #{p.payId}
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Add.Date</f:facet>
                    <!-- row record -->
                    <h:outputLabel value="#{p.addDate}">
                        <f:convertDateTime pattern="#{companySetting.getDateFormat()} H:mm" timeZone="#{companySetting.getTimeZone()}"/>
                    </h:outputLabel>
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Pay Method</f:facet>
                    <!-- row record -->
                    #{payMethodBean.getPayMethod(p.payMethodId).getPayMethodName()}
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Paid Amount</f:facet>
                    <!-- row record -->
                    <h:outputLabel value="#{p.paidAmount}" style="color: blue">
                        <f:convertNumber pattern="###,###,###"/>
                    </h:outputLabel>
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Points Spent Amount</f:facet>
                    <!-- row record -->
                    <h:outputLabel value="#{p.pointsSpentAmount}" style="color: blue">
                        <f:convertNumber pattern="###,###,###"/>
                    </h:outputLabel>
                </p:column>

                <p:column>
                    <!-- column header -->
                    <f:facet name="header">Action</f:facet>
                    <!-- row record -->
                    <h:commandLink styleClass="clsButton" id="cmdbDelete" value="Cancel.Pay" onclick="return confirmCancel();" rendered="#{payBean.isAllowCancelPay(p)}">
                        <f:ajax listener="#{payBean.cancelPay(p)}" execute="dtblPay" render="dtblPay" />
                    </h:commandLink>
                    <h:outputLabel value=" "/>
                    <h:commandLink styleClass="clsButton" value="View.Receipt" rendered="#{generalUserSetting.getCurrentPayCategory()=='IN'}">
                        <f:ajax listener="#{payBean.ViewReceiptVoucher(p.payId)}"/>
                    </h:commandLink>
                    <h:commandLink styleClass="clsButton" value="View.Voucher" rendered="#{generalUserSetting.getCurrentPayCategory()=='OUT'}">
                        <f:ajax listener="#{payBean.ViewReceiptVoucher(p.payId)}"/>
                    </h:commandLink>
                </p:column>

            </p:dataTable>
            <!-- RECEIPT/VOUCHER STARTS HERE -->
            <ui:include src="PayReceipt.xhtml"/>
            <!-- RECEIPT/VOUCHER ENDS HERE -->
        </h:form>
    </h:body>
</html>

